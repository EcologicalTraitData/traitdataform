<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Package ‘traitdataform’ • traitdataform</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">traitdataform</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/traitdataform.html">Get Started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/fdschneider/traitdataform">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Package ‘traitdataform’</h1>
                        <h4 class="author">Florian D. Schneider</h4>
            
            <h4 class="date">2017-11-21</h4>
          </div>

    
    
<div class="contents">
<p>This vignette contains step-by step instructions for transferring own data into a standardized trait-dataset for upload to public databases. The output object uses the trait data standard put forward in Schneider et al. XX (refer to pub).</p>
<div id="reading-data" class="section level1">
<h1 class="hasAnchor">
<a href="#reading-data" class="anchor"></a>1. reading data</h1>
<p>First, load your own data into R, preferrably in a species–trait matrix, occurrence table or measurement longtable format (See notes on different data formats of trait data).</p>
<p>You may rename the column names of the original file to match the column names described in the trait data standard, but this vignette also describes the mapping of the column names along the process of data handling.</p>
<p>R knows many ways of getting your original data into an R object. In most cases you would read an object from a csv or txt file while maintaining the column headers.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">carabids &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="st">"../../data/carabid traits final.txt"</span>, <span class="dt">header =</span> <span class="ot">TRUE</span>)</code></pre></div>
</div>
<div id="transfer-into-measurement-longtable-format" class="section level1">
<h1 class="hasAnchor">
<a href="#transfer-into-measurement-longtable-format" class="anchor"></a>2. transfer into measurement longtable format</h1>
<p>As explained in Schneider et al. XX, most trait data are stored in one of the following formats:</p>
<ul>
<li>
<strong>species-trait matrix</strong> : a single account of a trait value for each species (in rows) for a couple of different traits (in columns). No replicates of species are reported. This is the most likely format for literature data, where aggregate measurements or facts for entire species have been collated into a single lookup table.</li>
<li>
<strong>occurrence table</strong> : In case of measured data, authors may report multiple raw measurements of different traits (in columns) taken from a single occurrence of a species, i.e. an individual specimen (in rows). Repeated measures of the same trait might also be included as columns or pooled into average values. This is valuable for investigations of intra-specific variation, and also leaves space for filtering by cofactors or analysing trait response along environmental gradients.</li>
<li>
<strong>measurement longtable</strong> : For a standardisation of trait data for use in online databases, we propose a measurement longtable format, where each row comprises the reporting of a single measurement or fact, linked to a trait definition as well as a valid taxon name, and optionally to other layers of information. This data format is more predictable in terms of columns and thus easiert to merge with other datasets.</li>
</ul>
<p>In all cases, additional information on the reported value may be stored in further colums (e.g. the unit in which a value is reported or the literature source for this measurement or fact), or in a separate data sheet linked via identifiers for trait, taxon, occurrence or sampling/measurement event. Examples below will explain how these information can be added to the main data sheet.</p>
<p>The function <code><a href="../reference/as.traitdata.html">as.traitdata()</a></code> provided in the package assist in transferring any data format into the measurement longtable format. For this function to work, it needs to know about the columns of the original data that contain trait values (parameter <code>traits</code>), and the column which contains the taxonomic specification (parameter <code>taxa</code>).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(traitdataform)
<span class="kw">data</span>(carabids)</code></pre></div>
<pre><code>## loading dataset 'carabids' from original data source! 
##  When using this data, please cite the original publication: 
## van der Plas F, van Klink R, Manning P, Olff H and Fischer M
## (2017). "Sensitivity of functional diversity metrics to sampling
## intensity." _Methods in Ecology and Evolution_. doi:
## 10.1111/2041-210x.12728 (URL:
## http://doi.org/10.1111/2041-210x.12728).</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dataset1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/as.traitdata.html">as.traitdata</a></span>(carabids, 
                         <span class="dt">taxa =</span> <span class="st">"name_correct"</span>,
                         <span class="dt">traits =</span> <span class="kw">c</span>(<span class="st">"body_length"</span>, 
                                    <span class="st">"antenna_length"</span>, 
                                    <span class="st">"metafemur_length"</span>, 
                                    <span class="st">"eyewidth_corr"</span>)
                         )</code></pre></div>
<pre><code>## Input is taken to be a species -- trait matrix. If this is not the case, please provide parameters!</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(dataset1)</code></pre></div>
<pre><code>##          scientificName   traitName traitValue measurementID
## 1 Abax_parallelepipedus body_length  15.846561             1
## 2  Acupalpus_meridianus body_length   2.670000             2
## 3        Agonum_ericeti body_length   5.873016             3
## 4    Agonum_fuliginosum body_length   5.090000             4
## 5        Agonum_gracile body_length   4.880000             5
## 6     Agonum_marginatum body_length   8.250000             6
## 
## This trait-dataset contains 4 traits for 120 taxa ( 6 measurements in total).
## 
## [1]:</code></pre>
<p>Note that in the output table the columns have been named after the traitdata standard proposed in the whitepaper (ref). The essential columns are <code>traitName</code>, <code>traitValue</code> for the reported measurement or fact as well as <code>ScientificName</code> for the taxon assignment. The function auomaticall interprets data as species- trait matrix if the taxa column contains only unique entries and no duplicates.</p>
<p>In case of occurrence table data, an occurrenceID is provided automatically, or can be provided by the author using the parameter <code>occurrences</code> (as a column name or a vector of occurrence IDs).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(heteroptera_raw)</code></pre></div>
<pre><code>## loading dataset 'heteropteraRaw' from original data source! 
##  When using this data, please cite the original publication: 
## Gossner MM, Simons NK, Höck L and Weisser WW (2015). "Morphometric
## measures of Heteroptera sampled in grasslands across three regions
## of Germany." _Ecology_, *96*, pp. 1154. doi: 10.1890/14-2159.1
## (URL: http://doi.org/10.1890/14-2159.1).</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dataset2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/as.traitdata.html">as.traitdata</a></span>(heteroptera_raw,
              <span class="dt">traits =</span> <span class="kw">c</span>(<span class="st">"Body_length"</span>, <span class="st">"Body_width"</span>, <span class="st">"Body_height"</span>, <span class="st">"Thorax_length"</span>,
                         <span class="st">"Thorax_width"</span>, <span class="st">"Head_width"</span>, <span class="st">"Eye_width"</span>, <span class="st">"Antenna_Seg1"</span>,
                         <span class="st">"Antenna_Seg2"</span>, <span class="st">"Antenna_Seg3"</span>, <span class="st">"Antenna_Seg4"</span>, <span class="st">"Antenna_Seg5"</span>,
                         <span class="st">"Front.Tibia_length"</span>, <span class="st">"Mid.Tibia_length"</span>, <span class="st">"Hind.Tibia_length"</span>,
                         <span class="st">"Front.Femur_length"</span>, <span class="st">"Hind.Femur_length"</span>, <span class="st">"Front.Femur_width"</span>,
                         <span class="st">"Hind.Femur_width"</span>, <span class="st">"Rostrum_length"</span>, <span class="st">"Rostrum_width"</span>, 
                         <span class="st">"Wing_length"</span>, <span class="st">"Wing_width"</span>),
              <span class="dt">taxa =</span> <span class="st">"SpeciesID"</span>,
              <span class="dt">occurrences =</span> <span class="st">"ID"</span>
              )

<span class="co"># show different trait measurements for same occurrence/individual</span>
<span class="kw">subset</span>(dataset2, occurrenceID <span class="op">==</span><span class="st"> "5"</span> ) </code></pre></div>
<pre><code>##        scientificName          traitName traitValue measurementID
## 5    Acalypta parvula        Body_length       1.84             5
## 430  Acalypta parvula         Body_width       0.82           430
## 855  Acalypta parvula        Body_height       0.56           855
## 1280 Acalypta parvula      Thorax_length       0.17          1280
## 1705 Acalypta parvula       Thorax_width       0.84          1705
## 2130 Acalypta parvula         Head_width       0.36          2130
## 2555 Acalypta parvula          Eye_width       0.10          2555
## 2980 Acalypta parvula       Antenna_Seg1       0.07          2980
## 3405 Acalypta parvula       Antenna_Seg2       0.06          3405
## 3830 Acalypta parvula       Antenna_Seg3       0.40          3830
## 4255 Acalypta parvula       Antenna_Seg4       0.15          4255
## 4716 Acalypta parvula Front.Tibia_length       0.39          4716
## 5141 Acalypta parvula   Mid.Tibia_length       0.40          5141
## 5566 Acalypta parvula  Hind.Tibia_length       0.50          5566
## 5991 Acalypta parvula Front.Femur_length       0.42          5991
## 6416 Acalypta parvula  Hind.Femur_length       0.43          6416
## 6841 Acalypta parvula  Front.Femur_width       0.08          6841
## 7266 Acalypta parvula   Hind.Femur_width       0.07          7266
## 7691 Acalypta parvula     Rostrum_length       0.80          7691
## 8116 Acalypta parvula      Rostrum_width       0.08          8116
## 8541 Acalypta parvula        Wing_length       1.78          8541
## 8966 Acalypta parvula         Wing_width       0.65          8966
##      occurrenceID
## 5               5
## 430             5
## 855             5
## 1280            5
## 1705            5
## 2130            5
## 2555            5
## 2980            5
## 3405            5
## 3830            5
## 4255            5
## 4716            5
## 5141            5
## 5566            5
## 5991            5
## 6416            5
## 6841            5
## 7266            5
## 7691            5
## 8116            5
## 8541            5
## 8966            5
## 
## This trait-dataset contains 23 traits for 179 taxa ( 22 measurements in total).</code></pre>
<div id="case-example-provide-measurement-unit" class="section level2">
<h2 class="hasAnchor">
<a href="#case-example-provide-measurement-unit" class="anchor"></a>case example: provide measurement unit</h2>
<p>For a standardisation of quantitative trait data, the unit of measurement is essential. Often, this information is kept in the metadata descriptions. But for a standardised table containing measurements from different sources, this information should always accompany the measurement value. A common way to provide the unit is adding another column to your original data table containing the unit in an unambiguous format. The function <code>as.traittable()</code> assists in adding the units via its parameter <code>units</code>.</p>
<p>This can be done for all traits in a single stroke (if all reported values refer to the same unit) or to each trait specifically (if they used different measuremnt units or if the table comprises a mixture of quantitative and qualitative traits).</p>
<p>The syntax for this uses the parameter <code>units</code>, which takes a single character string, or a vector of character strings, containing valid entries as expected by the package ‘units’ (Pebesma et al. 2016, <a href="https://github.com/edzer/units/" class="uri">https://github.com/edzer/units/</a>, v0.4-5, Examples are ‘mm’, ‘m2’ or ‘m^2’, ‘m/s’).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(carabids)</code></pre></div>
<pre><code>## loading dataset 'carabids' from original data source! 
##  When using this data, please cite the original publication: 
## van der Plas F, van Klink R, Manning P, Olff H and Fischer M
## (2017). "Sensitivity of functional diversity metrics to sampling
## intensity." _Methods in Ecology and Evolution_. doi:
## 10.1111/2041-210x.12728 (URL:
## http://doi.org/10.1111/2041-210x.12728).</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dataset1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/as.traitdata.html">as.traitdata</a></span>(carabids, 
                         <span class="dt">taxa =</span> <span class="st">"name_correct"</span>,
                         <span class="dt">traits =</span> <span class="kw">c</span>(<span class="st">"body_length"</span>, 
                                    <span class="st">"antenna_length"</span>, 
                                    <span class="st">"metafemur_length"</span>, 
                                    <span class="st">"eyewidth_corr"</span>),
                         <span class="dt">units =</span> <span class="st">"mm"</span>
                         )</code></pre></div>
<pre><code>## Input is taken to be a species -- trait matrix. If this is not the case, please provide parameters!</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(dataset1)</code></pre></div>
<pre><code>##          scientificName   traitName traitValue traitUnit measurementID
## 1 Abax_parallelepipedus body_length  15.846561        mm             1
## 2  Acupalpus_meridianus body_length   2.670000        mm             2
## 3        Agonum_ericeti body_length   5.873016        mm             3
## 4    Agonum_fuliginosum body_length   5.090000        mm             4
## 5        Agonum_gracile body_length   4.880000        mm             5
## 6     Agonum_marginatum body_length   8.250000        mm             6
## 
## This trait-dataset contains 4 traits for 120 taxa ( 6 measurements in total).
## 
## [1]:</code></pre>
<p>A character vector should have the same length as the provided vector of trait names (in parameter <code>traits</code>), or otherwise should be a named vector of the form <code>c(trait1 = "mm", trait2 = "mm2")</code>, where only the traits provided will receive units while the others will remain blank.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(arthropodtraits)</code></pre></div>
<pre><code>## loading dataset 'arthropodtraits' from original data source! 
##  When using this data, please cite the original publication: 
## Gossner MM, Simons NK, Achtziger R, Blick T, Dorow W, Dziock F,
## Köhler F, Rabitsch W and Weisser WW (2015). "A summary of eight
## traits of Coleoptera, Hemiptera, Orthoptera and Araneae, occurring
## in grasslands in Germany." _Scientific Data_, *2*, pp. 150013.
## doi: 10.1038/sdata.2015.13 (URL:
## http://doi.org/10.1038/sdata.2015.13).</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dataset3 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/as.traitdata.html">as.traitdata</a></span>(arthropodtraits,
                         <span class="dt">taxa =</span> <span class="st">"SpeciesID"</span>,
                         <span class="dt">traits =</span> <span class="kw">c</span>(<span class="st">"Body_Size"</span>, <span class="st">"Dispersal_ability"</span>, <span class="st">"Feeding_guild"</span>,
                                    <span class="st">"Feeding_mode"</span>, <span class="st">"Feeding_specialization"</span>, 
                                    <span class="st">"Feeding_tissue"</span>, <span class="st">"Feeding_plant_part"</span>,
                                    <span class="st">"Endophagous_lifestyle"</span>, <span class="st">"Stratum_use"</span>,
                                    <span class="st">"Stratum_use_short"</span>), 
                         <span class="dt">units =</span> <span class="kw">c</span>(<span class="dt">Body_Size =</span> <span class="st">"mm"</span>, <span class="dt">Dispersal_ability =</span> <span class="st">"unitless"</span>)
)</code></pre></div>
<pre><code>## Input is taken to be a species -- trait matrix. If this is not the case, please provide parameters!</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(dataset3)</code></pre></div>
<pre><code>##         scientificName traitName traitValue traitUnit measurementID
## 1 Anyphaena accentuata Body_Size       6.25        mm             1
## 2 Aculepeira ceropegia Body_Size         11        mm             2
## 3     Agalenatea redii Body_Size       6.93        mm             3
## 4   Araneus diadematus Body_Size      11.88        mm             4
## 5    Araneus marmoreus Body_Size      10.03        mm             5
## 6    Araneus quadratus Body_Size      12.25        mm             6
## 
## This trait-dataset contains 10 traits for 1230 taxa ( 6 measurements in total).
## 
## [1]:</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(heteroptera)</code></pre></div>
<pre><code>## loading dataset 'heteroptera' from original data source! 
##  When using this data, please cite the original publication: 
## Gossner MM, Simons NK, Höck L and Weisser WW (2015). "Morphometric
## measures of Heteroptera sampled in grasslands across three regions
## of Germany." _Ecology_, *96*, pp. 1154. doi: 10.1890/14-2159.1
## (URL: http://doi.org/10.1890/14-2159.1).</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dataset4 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/as.traitdata.html">as.traitdata</a></span>(heteroptera,
              <span class="dt">traits =</span> <span class="kw">c</span>(<span class="st">"Body_length"</span>, <span class="st">"Body_volume"</span>, <span class="st">"Rel_wing_length"</span>, 
                         <span class="st">"Hind.Femur_shape"</span>, <span class="st">"Rel_Hind.Femur_length"</span>, 
                         <span class="st">"Rel_Rostrum_length"</span>, <span class="st">"Front.Femur_shape"</span>, 
                         <span class="st">"Body_shape"</span>, <span class="st">"Rel_eye_size"</span>, <span class="st">"Rel_Antenna_length"</span>
                         ),
              <span class="dt">taxa =</span> <span class="st">"SpeciesID"</span>,
              <span class="dt">units =</span> <span class="kw">c</span>(<span class="st">"mm"</span>, <span class="st">"mm3"</span>, <span class="kw">rep</span>(<span class="st">"unitless"</span>, <span class="dv">8</span>))
              )</code></pre></div>
<pre><code>## Input is taken to be a species -- trait matrix. If this is not the case, please provide parameters!</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(dataset4) </code></pre></div>
<pre><code>##                 scientificName   traitName traitValue traitUnit
## 1             Acalypta nigrina Body_length       2.19        mm
## 2             Acalypta parvula Body_length       1.73        mm
## 3         Acalypta platycheila Body_length       2.22        mm
## 4           Acetropis carinata Body_length       5.73        mm
## 5      Adelphocoris lineolatus Body_length       6.84        mm
## 6 Adelphocoris quadripunctatus Body_length       7.95        mm
##   measurementID
## 1             1
## 2             2
## 3             3
## 4             4
## 5             5
## 6             6
## 
## This trait-dataset contains 10 traits for 0 taxa ( 6 measurements in total).
## 
## [1]:</code></pre>
<p>Logical or factorial traits ususally don’t come with a unit. In mixed data, the field should specify as empty, <code>""</code> or as<code>NA</code>.</p>
</div>
<div id="case-example-raw-data-are-coded-as-numeric-factor-levels" class="section level2">
<h2 class="hasAnchor">
<a href="#case-example-raw-data-are-coded-as-numeric-factor-levels" class="anchor"></a>case example: raw data are coded as numeric factor levels</h2>
<p>The data table should be human readable, thus you may consider translation into true factorial data via the function <code><a href="../reference/mutate.traitdata.html">mutate.traitdata()</a></code>.</p>
<p>This may not be useful if the numeric levels correspond to fine grained distinctions that cannot be translated into short factor levels.</p>
<p>A translation into factorials is even ill-adviced if factor levels are ordinal, i.e. they correspond to a sequence of logically ordered levels and the ordering would be lost by translating into factorials: The traitdata object will not keep ordinal level definitions of the original R data.frame. In this case, integer numerical values are best to describe the relational structure of the factor levels.</p>
<p>Please don’t forget to provide a definition of factor levels in the metadata description of variables or in an accompanying dataset containing trait definitions.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">updated &lt;-<span class="st"> </span><span class="kw"><a href="../reference/mutate.traitdata.html">mutate.traitdata</a></span>(dataset3, 
                            <span class="dt">predator =</span> Feeding_guild <span class="op">==</span><span class="st"> "c"</span>, 
                            <span class="dt">Feeding_specialization =</span> <span class="kw">factor</span>(Feeding_specialization, 
                                            <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">"m"</span>,<span class="st">"o"</span>, <span class="st">"p"</span>), 
                                            <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">"monophagous"</span>, <span class="st">"oligophagous"</span>,
                                                       <span class="st">"polyphagous"</span>)
                                            ),
                            <span class="dt">Stratum_use =</span> <span class="kw">factor</span>(Stratum_use_short, 
                                                 <span class="dt">levels =</span> <span class="kw">c</span>(<span class="st">"s"</span>,<span class="st">"g"</span>, <span class="st">"h"</span>, <span class="st">"t"</span>), 
                                                 <span class="dt">ordered =</span> <span class="ot">TRUE</span>, 
                                                 <span class="dt">labels =</span> <span class="kw">c</span>(<span class="st">"soil"</span>,<span class="st">"ground"</span>,<span class="st">"herb"</span>,<span class="st">"shrub"</span>)
                                                 )
                            )

<span class="kw">head</span>(<span class="kw">subset</span>(updated, traitName <span class="op">==</span><span class="st"> "Stratum_use"</span>))</code></pre></div>
</div>
<div id="case-example-keep-additional-data-columns" class="section level2">
<h2 class="hasAnchor">
<a href="#case-example-keep-additional-data-columns" class="anchor"></a>case example: keep additional data columns</h2>
<p>The raw data might contain further information on the specimen or the trait measurement itself in further data columns that are valuable for later analysis. This can be for instance data about the sex or developmental stage of the individual, the sampling or preservation method of the specimen, or the conditions under which the measurement was taken.</p>
<p>The parameter <code>keep</code> allows you to specify which columns contain valuable information as a character vector. As a negative version of <code>keep</code>, specifying <code>drop</code> would allow you to name the columns that are not valueable, while all others will be kept. Not specifying <code>keep</code> or <code>drop</code> will result in dropping all columns except the core measurement and identifier columns.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(heteroptera_raw)</code></pre></div>
<pre><code>## loading dataset 'heteropteraRaw' from original data source! 
##  When using this data, please cite the original publication: 
## Gossner MM, Simons NK, Höck L and Weisser WW (2015). "Morphometric
## measures of Heteroptera sampled in grasslands across three regions
## of Germany." _Ecology_, *96*, pp. 1154. doi: 10.1890/14-2159.1
## (URL: http://doi.org/10.1890/14-2159.1).</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dataset2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/as.traitdata.html">as.traitdata</a></span>(heteroptera_raw,
              <span class="dt">traits =</span> <span class="kw">c</span>(<span class="st">"Body_length"</span>, <span class="st">"Body_width"</span>, <span class="st">"Body_height"</span>, <span class="st">"Thorax_length"</span>,
                         <span class="st">"Thorax_width"</span>, <span class="st">"Head_width"</span>, <span class="st">"Eye_width"</span>, <span class="st">"Antenna_Seg1"</span>,
                         <span class="st">"Antenna_Seg2"</span>, <span class="st">"Antenna_Seg3"</span>, <span class="st">"Antenna_Seg4"</span>, <span class="st">"Antenna_Seg5"</span>,
                         <span class="st">"Front.Tibia_length"</span>, <span class="st">"Mid.Tibia_length"</span>, <span class="st">"Hind.Tibia_length"</span>,
                         <span class="st">"Front.Femur_length"</span>, <span class="st">"Hind.Femur_length"</span>, <span class="st">"Front.Femur_width"</span>,
                         <span class="st">"Hind.Femur_width"</span>, <span class="st">"Rostrum_length"</span>, <span class="st">"Rostrum_width"</span>, 
                         <span class="st">"Wing_length"</span>, <span class="st">"Wing_width"</span>),
              <span class="dt">taxa =</span> <span class="st">"SpeciesID"</span>,
              <span class="dt">occurrences =</span> <span class="st">"ID"</span>,
              <span class="dt">keep =</span> <span class="kw">c</span>(<span class="st">"Sex"</span>)
              )

<span class="kw">head</span>(dataset2) </code></pre></div>
<pre><code>##     scientificName   traitName traitValue measurementID occurrenceID Sex
## 1 Acalypta nigrina Body_length       2.35             1            1   f
## 2 Acalypta nigrina Body_length       2.10             2            2   f
## 3 Acalypta nigrina Body_length       2.17             3            3   m
## 4 Acalypta nigrina Body_length       2.15             4            4   m
## 5 Acalypta parvula Body_length       1.84             5            5   f
## 6 Acalypta parvula Body_length       1.81             6            6   f
## 
## This trait-dataset contains 23 traits for 179 taxa ( 6 measurements in total).
## 
## [1]:</code></pre>
<p>The traitdata standard (whitepaper) suggests standard names for many of these extra information, which might fall into the domain of the extensions for occurrence or measurementOrFact (see below). We highly reccomend mapping the columns provided into these standard names by using the rename feature of the <code><a href="../reference/as.traitdata.html">as.traitdata()</a></code> function. This is simply acheived by providing a named vector for <code>keep</code> that uses the compatible column names as vector names.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dataset1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/as.traitdata.html">as.traitdata</a></span>(carabids, 
                         <span class="dt">taxa =</span> <span class="st">"name_correct"</span>,
                         <span class="dt">traits =</span> <span class="kw">c</span>(<span class="st">"body_length"</span>, <span class="st">"antenna_length"</span>, 
                                    <span class="st">"metafemur_length"</span>),
                         <span class="dt">units =</span> <span class="st">"mm"</span>,
                         <span class="dt">keep =</span> <span class="kw">c</span>(<span class="dt">measurementDeterminedBy =</span> <span class="st">"source_measurement"</span>)
                         )</code></pre></div>
<pre><code>## Input is taken to be a species -- trait matrix. If this is not the case, please provide parameters!</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(dataset1)</code></pre></div>
<pre><code>##          scientificName   traitName traitValue traitUnit measurementID
## 1 Abax_parallelepipedus body_length  15.846561        mm             1
## 2  Acupalpus_meridianus body_length   2.670000        mm             2
## 3        Agonum_ericeti body_length   5.873016        mm             3
## 4    Agonum_fuliginosum body_length   5.090000        mm             4
## 5        Agonum_gracile body_length   4.880000        mm             5
## 6     Agonum_marginatum body_length   8.250000        mm             6
##   measurementDeterminedBy
## 1                   klink
## 2                WOODCOCK
## 3                   klink
## 4                  ribera
## 5                  ribera
## 6                  ribera
## 
## This trait-dataset contains 3 traits for 120 taxa ( 6 measurements in total).
## 
## [1]:</code></pre>
<p>Note that a lack of a name in the named vector maintains the original name. Note also, that no checking for valid column names (as compared to the traitdata glossary) is performed at this stage. This is to ensure that the raw data table created by <code>as.traittable()</code> can contain any columns that the author considers relevant. The <code>keep</code> parameter can be used to rename columns into intuitive column names.</p>
</div>
<div id="case-example-adding-further-information-on-traits-species-or-single-measurements" class="section level2">
<h2 class="hasAnchor">
<a href="#case-example-adding-further-information-on-traits-species-or-single-measurements" class="anchor"></a>case example: adding further information on traits, species or single measurements</h2>
<p>Beyond measurement units, further information might be available that are not recorded in the raw data table, but are related to the trait type, the taxon, the individual or specimen, or to the reported fact, measurement or sampling event.</p>
<p>In most cases those information are kept in seperate data sheets of your file, e.g. the place were a specimen has been sampled or the literature source from where a species value has been cited. In this case, a unique identifier might link to this other datasheet, such as a number for each individual occurrence of a specimen (<code>occurrenceID</code>) or an identifier for a single measurement or reported fact (<code>measurementID</code>).</p>
<p>The trait data standard provides two extensions of the namespace that should be used to describe these data:</p>
<ul>
<li>the <code>occurrence</code> extension contains information on the level of individual specimens, such as date and location and method of sampling and preservation, or physiological specifications of the phenotype, such as sex, life stage or age.</li>
<li>the <code>measurementOrFact</code> extension takes information at the level of single measurements or reported values, such as the original literature from where the value is cited, the method of measurement or statistical method of aggregation.</li>
</ul>
<p>The extensions are compatible with Darwin Core Standard and EOL TraitBank.</p>
<p>You may decide to keep the information in a seperate data sheet. In that case, the traitdata table should at least contain a column with the respective identifier that directs to the covariate datasheet. The identifier might also take the format of a globally valid URI or API call.</p>
<p>It is however recommended to add these information directly as own columns within the data table to enable an analysis of cofactors and correlations further down the road. This way, if datasets of different source are merged, the information is readily available without the risk of breaking the reference to an external datasheet.</p>
<p>The function <code><a href="../reference/as.traitdata.html">as.traitdata()</a></code> provides a set of parameters to add information at the different levels. The following three examples will illustrate how to add covariates to each occurrence or measurement. The principle is always the same: A unique identifier for these levels of information can be associated with a vector or data table containing the additional information, which will then be merged into the data table. The functionality builds on the base R function <code>merge.data.frame</code>, but checks for compatibility with the glossary of terms of the traitdata standard.</p>
<!-- TODO: add functionality -->
<div id="adding-information-on-specimen-level-occurrence-extension" class="section level3">
<h3 class="hasAnchor">
<a href="#adding-information-on-specimen-level-occurrence-extension" class="anchor"></a>Adding information on specimen level (occurrence Extension)</h3>
<ul>
<li>under construction -</li>
</ul>
</div>
<div id="adding-information-on-measurement-or-fact-measurementorfact-extension" class="section level3">
<h3 class="hasAnchor">
<a href="#adding-information-on-measurement-or-fact-measurementorfact-extension" class="anchor"></a>Adding information on measurement or fact (measurementOrFact Extension)</h3>
<ul>
<li>under construction -</li>
</ul>
</div>
</div>
<div id="case-example-mutate-original-columns-into-derived-values" class="section level2">
<h2 class="hasAnchor">
<a href="#case-example-mutate-original-columns-into-derived-values" class="anchor"></a>case example: mutate original columns into derived values</h2>
<p>Many traits comprise compound measures of multiple traits, such as length-mass ratios or morphometric indices. Other traits must be refined in terms of factor levels, or reduced to binary trait values. While many of these tasks can be achieved on the raw data using base functions like <code>transform()</code>, <code>factor()</code> or <code>match()</code> or the <code>mutate()</code> function provided by the package ‘plyr’.</p>
<p>The function <code><a href="../reference/mutate.traitdata.html">mutate.traitdata()</a></code> performs these tasks (working as a wrapper to <code><a href="http://www.rdocumentation.org/packages/plyr/topics/mutate">plyr::mutate()</a></code>).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">updated &lt;-<span class="st"> </span><span class="kw"><a href="../reference/mutate.traitdata.html">mutate.traitdata</a></span>(dataset2, 
                            <span class="dt">Body_shape =</span> Body_length<span class="op">/</span>Body_width, 
                            <span class="dt">Body_volume =</span> Body_length<span class="op">*</span>Body_width<span class="op">*</span>Body_height,
                            <span class="dt">Wingload =</span> Wing_length<span class="op">*</span>Wing_width<span class="op">/</span>Body_volume)

<span class="kw">head</span>(updated[updated<span class="op">$</span>traitName <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">"Body_shape"</span>, <span class="st">"Body_volume"</span>, <span class="st">"Wingload"</span>),])</code></pre></div>
<pre><code>##        scientificName  traitName traitValue measurementID occurrenceID Sex
## 9387 Acalypta nigrina Body_shape   2.043478          &lt;NA&gt;            1   f
## 9388 Acalypta nigrina Body_shape   1.721311          &lt;NA&gt;            2   f
## 9389 Acalypta nigrina Body_shape   2.028037          &lt;NA&gt;            3   m
## 9390 Acalypta nigrina Body_shape   2.067308          &lt;NA&gt;            4   m
## 9391 Acalypta parvula Body_shape   2.243902          &lt;NA&gt;            5   f
## 9392 Acalypta parvula Body_shape   1.885417          &lt;NA&gt;            6   f
## 
## This trait-dataset contains 26 traits for 179 taxa ( 6 measurements in total).
## 
## [1]:</code></pre>
<p>Note that all existing traits remain untouched and additional trait measures will be added to the dataset, unless a definition replaces an already existing trait (such as ‘Stratum_use’ in this example).</p>
<p>It is important to note that the mutate function works at the level of data resolution that is provided by the data, i.e. for occurrence data with multiple measurements on a single individual, the data columns are mutated per occurrenceID.</p>
</div>
</div>
<div id="standardise-taxon-names-and-trait-values" class="section level1">
<h1 class="hasAnchor">
<a href="#standardise-taxon-names-and-trait-values" class="anchor"></a>3. standardise taxon names and trait values</h1>
<p>Step 1 and 2 produced a tidy and correctly formatted version of your own trait data. We now turn to the challenging task of standardisation. Two aspects of trait data need thorough standardisation: the names of species and higher taxa need to be mapped to globally accepted definitions and the names of traits should be referenced to unambiguous definitions and, where possible, translated to standard units and accepted factor levels.</p>
<div id="taxon-name-standardisation" class="section level2">
<h2 class="hasAnchor">
<a href="#taxon-name-standardisation" class="anchor"></a>taxon name standardisation</h2>
<p>For taxon name standardisation, the function <code><a href="../reference/standardize.taxonomy.html">standardize.taxonomy()</a></code> makes use of fuzzy matching algorithms provided by the package ‘taxize’ to match the entries of column <code>scientificName</code> against the GBIF Backbone Taxonomy (taxize v). The result is written into a new column <code>scientificNameStd</code>. Additional columns comprise the order (for ambiguous names), the reported taxon rank, as well as a globally unique taxon ID which references the taxon to GBIF Backbone Taxonomy in a universal URI format.</p>
<p>If further layers of taxonomic information are desired as an output, the function takes the parameter <code>return</code>, which by default contains <code>c("taxonID", "scientificNameStd", "order", "taxonRank")</code>. Other specifications can be added here.</p>
<p>Note that for this to work, <code>scientificName</code> must contain a full account of the species name or higher taxon, no abbreviations (spaces or underscores are handled alright).</p>
<p>Note also, that taxon name mapping requires an internet connection and might take some time, depending on the length of your species list.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dataset1Std &lt;-<span class="st"> </span><span class="kw"><a href="../reference/standardize.taxonomy.html">standardize.taxonomy</a></span>(dataset1)
<span class="kw">head</span>(dataset1Std)</code></pre></div>
<pre><code>##          scientificName        traitName traitValue traitUnit
## 1 Abax_parallelepipedus metafemur_length   5.608466        mm
## 2 Abax_parallelepipedus   antenna_length   8.518519        mm
## 3 Abax_parallelepipedus      body_length  15.846561        mm
## 4  Acupalpus_meridianus metafemur_length   0.750000        mm
## 5  Acupalpus_meridianus   antenna_length   0.700000        mm
## 6  Acupalpus_meridianus      body_length   2.670000        mm
##       scientificNameStd taxonRank      order
## 1 Abax parallelepipedus   species Coleoptera
## 2 Abax parallelepipedus   species Coleoptera
## 3 Abax parallelepipedus   species Coleoptera
## 4  Acupalpus meridianus   species Coleoptera
## 5  Acupalpus meridianus   species Coleoptera
## 6  Acupalpus meridianus   species Coleoptera
##                               taxonID measurementID warnings
## 1 http://www.gbif.org/species/5754772           241         
## 2 http://www.gbif.org/species/5754772           121         
## 3 http://www.gbif.org/species/5754772             1         
## 4 http://www.gbif.org/species/1037633           242         
## 5 http://www.gbif.org/species/1037633           122         
## 6 http://www.gbif.org/species/1037633             2         
##   measurementDeterminedBy
## 1                   klink
## 2                   klink
## 3                   klink
## 4                WOODCOCK
## 5                WOODCOCK
## 6                WOODCOCK
## 
## This trait-dataset contains 3 traits for 120 taxa ( 6 measurements in total).
## 
## [1]:</code></pre>
</div>
<div id="trait-name-and-value-standardisation" class="section level2">
<h2 class="hasAnchor">
<a href="#trait-name-and-value-standardisation" class="anchor"></a>trait name and value standardisation</h2>
<p>Due to the heterogeneity of approaches and research questions related to trait-based research, a universal trait definition standard does not exist at the time of writing this. Therefore it is difficult to assign globally unique identifiers that provide a reference to an unambiguous definition. Some databases offer a list of traits in some way or another, e.g. as a datasheet of in-text table, but few offer a stable URI reference or an API. Exceptions are the Gramene Ontology, which offers trait definitions for crop plants, and the TOP thesaurus for plant traits (<a href="http://top-thesaurus.org" class="uri">http://top-thesaurus.org</a>), which is rather comprehensive, but does not provide easy means of referencing. Many such trait ontologies are currently under construction for different animal phyla.</p>
<p>For most cases, you would instead refer to an own lookup table, a so called thesaurus of traits, using dataset specific identifiers. The thesaurus may also be part of your metadata accompanying the trait dataset.</p>
<p>To transfer the user provided traits and trait values into standardised values, the function <code><a href="../reference/standardize.traits.html">standardize.traits()</a></code> merges the data table with a reference table of trait definitions to produce values of a compliant format.</p>
<div id="refer-to-an-existing-trait-ontology" class="section level3">
<h3 class="hasAnchor">
<a href="#refer-to-an-existing-trait-ontology" class="anchor"></a>refer to an existing trait ontology</h3>
<p>A couple of trait ontologies do exist, e.g. the TOP Thesaurus of plant traits (used by TRY) or Gramene.org offer definitions of plant traits via an API. For soil invertebrates, the T-SITA thesaurus offers a set of traits relevant for this organism group. To date, no script for a systematic access of these ontologies can be provided here. Thus, the key information must be provided manually as an own data object in R.</p>
<p>This procedure is only recommended if <em>all</em> of the traits reported in your dataset refer to a definition in an online thesaurus.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">traits1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/as.thesaurus.html">as.thesaurus</a></span>(<span class="kw">data.frame</span>(
                      <span class="dt">trait =</span> <span class="kw">c</span>(
                        <span class="st">"body_length"</span>, 
                        <span class="st">"antenna_length"</span>,
                        <span class="st">"metafemur_length"</span>
                        ),
                      <span class="dt">identifier =</span> <span class="kw">c</span>(
                        <span class="st">"http://t-sita.cesab.org/BETSI_vizInfo.jsp?trait=Body_length"</span>,
                        <span class="st">"http://t-sita.cesab.org/BETSI_vizInfo.jsp?trait=Antenna_length"</span>,
                        <span class="st">"http://t-sita.cesab.org/BETSI_vizInfo.jsp?trait=Femur_length"</span>
                        ), 
                      <span class="dt">valueType =</span> <span class="kw">c</span>(<span class="st">"numeric"</span>),
                      <span class="dt">expectedUnit =</span> <span class="st">"mm"</span>)
)</code></pre></div>
<p>We highly encourage the implementation of open online resources for these glossaries (e.g. via APIs), which would allow a looking up existing trait definitions programmatically, and match user provided names to accepted trait names via fuzzy matching.</p>
</div>
<div id="refer-to-an-own-trait-thesaurus" class="section level3">
<h3 class="hasAnchor">
<a href="#refer-to-an-own-trait-thesaurus" class="anchor"></a>refer to an own trait thesaurus</h3>
<p>If no published trait definition is available that can be referenced, trait-datasets should be accompanied by a dataset-specific glossary of traits, or thesaurus. A thesaurus provides a “controlled vocabulary designed to clarify the definition and structuring of key terms and associated concepts in a specific discipline”.</p>
<p>Ideally this thesaurus is stored as an asset along with your trait dataset or in a public file on the internet. This can be a csv or txt file published on a open access repository (figshare, researchgate or github, to name but a few), or a website providing direct links to the trait definition (URI).</p>
<p>This reference file should contain at least the following columns:</p>
<ul>
<li>
<code>trait</code> should be a short descriptive name. No spaces should be used. Rather use a scheme with underscore or capital letters to highlight multiple words (e.g. ‘body_length’ or ‘bodyLenght’).</li>
<li>
<code>identifier</code> should specify an alphanumeric ID for the specific use in your dataset or - better - a URI that reliably links to the definition of the trait measurement on an online repository. This could be achieved by providing a online version of your traitlist (TODO: provide instructions in wiki how to achieve this). We highly encourage to submit your own trait definitions to existing ontology servers to facilitate this process of trait standardisation (e.g. with GFBio).</li>
<li>
<code>traitDescription</code>: a detailled and unambiguous, human readable definition.</li>
<li>
<code>valueType</code> to specify the expected kind of entries. Set it to ‘numeric’ for quantitative traits, ‘integer’ for counts or ordinal traits, ‘character’ for trait values that are provided as free text, ‘factor’ for traits that take one of few non-ordinal levels, ‘logical’ for binary/boolean entries (yes/no).<br>
</li>
<li>For <em>numeric traits</em>, the parameter <code>expectedUnit</code> should provide the expected unit for the trait. The R script will then try to convert trait values into this unit.</li>
<li>for <em>categorical traits</em> of kind ‘factor’ or ‘integer’, the field <code>factorLevels</code> should contain a list the valid factorial traits separated by semicolon. In case of ordinal traits, the order must be precisely corresponding to the number of possible integer values.</li>
<li>
<code>comments</code> may contain examples and clarifications</li>
</ul>
<p>The trait thesaurus can be created from a data.frame using the function <code><a href="../reference/as.thesaurus.html">as.thesaurus()</a></code>. The parameter <code>replace</code> can be used for fixing column names to the expected names outlined above (see function <code><a href="http://www.rdocumentation.org/packages/plyr/topics/rename">plyr::rename()</a></code> of the plyr package).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">traits1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/as.thesaurus.html">as.thesaurus</a></span>(
     <span class="kw">read.csv</span>(<span class="st">"https://raw.githubusercontent.com/EcologicalTraitData/TraitDataList/master/traitdatastandard_traitlist.csv"</span>), 
     <span class="dt">replace =</span> <span class="kw">c</span>(
       <span class="dt">traitID =</span> <span class="st">"identifier"</span>, 
       <span class="dt">traitName =</span> <span class="st">"trait"</span>,
       <span class="dt">traitUnit =</span> <span class="st">"expectedUnit"</span>,
       <span class="dt">Comments =</span> <span class="st">"comments"</span>
       ) 
 )</code></pre></div>
<p>In R, the thesaurus can be created manually by providing objects of class ‘trait’ for the function <code><a href="../reference/as.thesaurus.html">as.thesaurus()</a></code> which will be used to create a valid data frame. This is especially useful if your data comprise only a small number of traits. Using the <code><a href="../reference/as.trait.html">as.trait()</a></code> syntax may allow a more flexible trait definition and an ensures compliance with the terms of the traitdata standard outlined above. It also allows building a library of trait definitions where single traits can be reused in multiple projects.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">traits1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/as.thesaurus.html">as.thesaurus</a></span>(
   <span class="dt">body_length =</span> <span class="kw"><a href="../reference/as.trait.html">as.trait</a></span>(<span class="st">"body_length"</span>, 
     <span class="dt">expectedUnit =</span> <span class="st">"mm"</span>, <span class="dt">valueType =</span> <span class="st">"numeric"</span>, 
     <span class="dt">identifier =</span> <span class="st">"http://t-sita.cesab.org/BETSI_vizInfo.jsp?trait=Body_length"</span>), 
   <span class="dt">antenna_length =</span> <span class="kw"><a href="../reference/as.trait.html">as.trait</a></span>(<span class="st">"antenna_length"</span>, 
     <span class="dt">expectedUnit =</span> <span class="st">"mm"</span>, <span class="dt">valueType =</span> <span class="st">"numeric"</span>, 
     <span class="dt">identifier =</span> <span class="st">"http://t-sita.cesab.org/BETSI_vizInfo.jsp?trait=Antenna_length"</span>),
   <span class="dt">metafemur_length =</span> <span class="kw"><a href="../reference/as.trait.html">as.trait</a></span>(<span class="st">"metafemur_length"</span>, 
     <span class="dt">expectedUnit =</span> <span class="st">"mm"</span>, <span class="dt">valueType =</span> <span class="st">"numeric"</span>, 
     <span class="dt">identifier =</span> <span class="st">"http://t-sita.cesab.org/BETSI_vizInfo.jsp?trait=Femur_length"</span>)
)</code></pre></div>
</div>
<div id="standardise-trait-data" class="section level3">
<h3 class="hasAnchor">
<a href="#standardise-trait-data" class="anchor"></a>standardise trait data</h3>
<p>The function <code><a href="../reference/standardize.traits.html">standardize.traits()</a></code> now finally has all it needs to complete its job.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dataset1final &lt;-<span class="st"> </span><span class="kw"><a href="../reference/standardize.traits.html">standardize.traits</a></span>(dataset1Std, traits1)
<span class="kw">head</span>(dataset1final)</code></pre></div>
<pre><code>##            scientificName        traitName
## 1   Abax_parallelepipedus metafemur_length
## 2          Amara_communis metafemur_length
## 3   Carabus_problematicus metafemur_length
## 4    Acupalpus_meridianus metafemur_length
## 5 Anisodactylus_binotatus metafemur_length
## 6         Amara_equestris metafemur_length
##                                                        traitID traitValue
## 1 http://t-sita.cesab.org/BETSI_vizInfo.jsp?trait=Femur_length   5.608466
## 2 http://t-sita.cesab.org/BETSI_vizInfo.jsp?trait=Femur_length   1.890000
## 3 http://t-sita.cesab.org/BETSI_vizInfo.jsp?trait=Femur_length   8.140000
## 4 http://t-sita.cesab.org/BETSI_vizInfo.jsp?trait=Femur_length   0.750000
## 5 http://t-sita.cesab.org/BETSI_vizInfo.jsp?trait=Femur_length   2.685185
## 6 http://t-sita.cesab.org/BETSI_vizInfo.jsp?trait=Femur_length   2.301587
##   traitUnit       scientificNameStd     traitNameStd traitValueStd
## 1        mm   Abax parallelepipedus metafemur_length            NA
## 2        mm          Amara communis metafemur_length            NA
## 3        mm   Carabus problematicus metafemur_length            NA
## 4        mm    Acupalpus meridianus metafemur_length            NA
## 5        mm Anisodactylus binotatus metafemur_length            NA
## 6        mm         Amara equestris metafemur_length            NA
##   traitUnitStd taxonRank      order                             taxonID
## 1           mm   species Coleoptera http://www.gbif.org/species/5754772
## 2           mm   species Coleoptera http://www.gbif.org/species/4472849
## 3           mm   species Coleoptera http://www.gbif.org/species/4470555
## 4           mm   species Coleoptera http://www.gbif.org/species/1037633
## 5           mm   species Coleoptera http://www.gbif.org/species/1036917
## 6           mm   species Coleoptera http://www.gbif.org/species/4472993
##   measurementID warnings measurementDeterminedBy
## 1           241                            klink
## 2           255                           ribera
## 3           297                           ribera
## 4           242                         WOODCOCK
## 5           270                            klink
## 6           257                            klink
## 
## This trait-dataset contains 3 traits for 120 taxa ( 6 measurements in total).
## 
## [1]:</code></pre>
<p>What does the function do in terms of standardisation.</p>
<ul>
<li>
<strong>Unit conversion</strong>: on all numerical traits, unit conversion to the target unit will be attempted. Unit conversion can only be successfully performed if both columns <code>traitUnit</code> and <code>traitUnitStd</code> are provided with valid unit names for the numeric trait.</li>
<li>
<strong>factor level checking</strong> : if a controlled vocabulary is provided in the trait thesaurus, the function checks whether the provided factor levels are valid and asks for a mapping vector otherwise. (<strong>not functional!</strong>)</li>
<li>
<strong>logical value harmonization</strong> : for logical traits, the function harmonizes the standardised output. By default it produces a vector of TRUE and FALSE entries. Missing values return NA. The parameters <code>output</code> and <code>categories</code> can be provided to function <code><a href="../reference/standardize.html">standardize()</a></code>. See <code><a href="../reference/fixlogical.html">?fixlogical</a></code> for further detail.</li>
</ul>
</div>
</div>
<div id="georeference-standardization-for-biodiversity-exploratories" class="section level2">
<h2 class="hasAnchor">
<a href="#georeference-standardization-for-biodiversity-exploratories" class="anchor"></a>georeference standardization for Biodiversity Exploratories</h2>
<p>The traitdata standard has been developed within the Biodiversity Exploratories project (DFG ) which is a long-term assessment of plant and animal communities in three regions across Germany starting in 2008. Trait data extracted from one of the 300 project plots can be georeferenced using the function <code><a href="../reference/standardize.exploratories.html">standardize.exploratories()</a></code>.</p>
<p>To access the high-resolution location data, credentials to BEXIS will be requested. If credentials are incorrect or missing, only low-resolution geolocation can be extracted.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># dataset by Jule Mangels et al. </span>

moths &lt;-<span class="st"> </span><span class="kw"><a href="../reference/read.service.html">read.service</a></span>(<span class="dv">21247</span>, <span class="dt">dec =</span> <span class="st">","</span>) 
 
dataset5 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/as.traitdata.html">as.traitdata</a></span>(moths, <span class="dt">taxa =</span> <span class="st">"species"</span>, <span class="dt">traits =</span> <span class="kw">c</span>(<span class="dt">body_mass =</span>
     <span class="st">"weight"</span>, <span class="dt">wing_length =</span> <span class="st">"wing_length"</span>, <span class="dt">wing_width =</span> <span class="st">"wing_width"</span>, <span class="dt">wing_area =</span>
     <span class="st">"wing_area"</span>, <span class="dt">wing_loading =</span> <span class="st">"wing_loading"</span>),
   <span class="dt">keep =</span> <span class="kw">c</span>(<span class="dt">locationID =</span> <span class="st">"plot"</span>))
 
dataset5Std &lt;-<span class="st"> </span><span class="kw"><a href="../reference/standardize.exploratories.html">standardize.exploratories</a></span>(dataset1)

<span class="kw">head</span>(dataset5Std)</code></pre></div>
</div>
<div id="single-stroke-standardization" class="section level2">
<h2 class="hasAnchor">
<a href="#single-stroke-standardization" class="anchor"></a>single stroke standardization</h2>
<p>The functions described here are applied sequentially. The output of the first step can be piped into the second step, etc.</p>
<p>To make things even simpler, the functions for format conversion and standardization are wrapped into one named <code><a href="../reference/standardize.html">standardize()</a></code>. Therefore it is possible to run the functions in a single handed way, if all necessary parameters for the intermediate steps are provided. A single call will do, taking all the optional parameters described above.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dataset1final &lt;-<span class="st"> </span><span class="kw"><a href="../reference/standardize.html">standardize</a></span>(carabids,
            <span class="dt">thesaurus =</span> traits1,
            <span class="dt">taxa =</span> <span class="st">"name_correct"</span>,
            <span class="dt">units =</span> <span class="st">"mm"</span>,
            <span class="dt">keep =</span> <span class="kw">c</span>(<span class="dt">measurementDeterminedBy =</span> <span class="st">"source_measurement"</span>)
            )</code></pre></div>
</div>
</div>
<div id="working-with-trait-datasets" class="section level1">
<h1 class="hasAnchor">
<a href="#working-with-trait-datasets" class="anchor"></a>4.Working with trait datasets</h1>
<div id="combine-multiple-traitdata-tables" class="section level2">
<h2 class="hasAnchor">
<a href="#combine-multiple-traitdata-tables" class="anchor"></a>combine multiple traitdata tables</h2>
<p>Combining separate datasets can be done using <code>rbind()</code> before or after the standardisation process, depending on the use case. Use cases of merging data are:</p>
<ul>
<li>you collected data from different sources and want to harmonize taxon and trait names: bring data in long-table format and merge into one data object, then harmonize taxa and units following a uniform standard</li>
<li>No unified trait list or taxon reference exists for the heterogeneous data assembled of different sources (e.g. because spanning many different taxa): Apply standardization to different reference systems before merging the datasets.</li>
</ul>
<p>The function call will append the data tables while merging the common columns and maintaining columns that are not present in all datasets (this might produce lots of NA). The column <code>datasetID</code> will be added to keep track of the origin of the data. By default this column will contain the object names of the original datasets, but it can be replaced by more meaningful IDs using the parameter <code>datasetID</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">newdata &lt;-<span class="st"> </span><span class="kw">rbind</span>(dataset1Std, dataset3, 
                <span class="dt">datasetID =</span> <span class="kw">c</span>(<span class="st">"carabids"</span>, <span class="st">"arthropodtraits"</span>)
              )</code></pre></div>
<pre><code>## Warning in rbind(deparse.level, ...): There seems to be no overlap in trait names of the provided datasets. 
##            It is recommended to map 'traitNameStd' of each dataset to the same thesaurus or ontology!</code></pre>
<pre><code>## Warning in rbind(deparse.level, ...): There seems to be no overlap in taxon names of the provided datasets. 
##             It is recommended to map 'ScientificNameStd' of each dataset to the same thesaurus or ontology!</code></pre>
<p>Note that the package provides a method for the base function <code>rbind()</code>. Documentation can be accessed via <code><a href="../reference/rbind.traitdata.html">?rbind.traitdata</a></code>.</p>
<p>The function will handle metadata information on the dataset level as described in the section ‘Metadata’ of the Traitdata Standard (e.g. <code>author</code> or <code>bibliographicCitation</code>) and add a column ‘datasetID’ as well as ‘datasetName’ and ‘author’ if those are provided in the attributes of the input objects. This can be achieved by using the metadata parameter of <code><a href="../reference/as.traitdata.html">as.traitdata()</a></code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(carabids)</code></pre></div>
<pre><code>## loading dataset 'carabids' from original data source! 
##  When using this data, please cite the original publication: 
## van der Plas F, van Klink R, Manning P, Olff H and Fischer M
## (2017). "Sensitivity of functional diversity metrics to sampling
## intensity." _Methods in Ecology and Evolution_. doi:
## 10.1111/2041-210x.12728 (URL:
## http://doi.org/10.1111/2041-210x.12728).</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dataset1 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/as.traitdata.html">as.traitdata</a></span>(carabids,
  <span class="dt">taxa =</span> <span class="st">"name_correct"</span>,
  <span class="dt">traits =</span> <span class="kw">c</span>(<span class="st">"body_length"</span>, <span class="st">"antenna_length"</span>, <span class="st">"metafemur_length"</span>),
  <span class="dt">units =</span> <span class="st">"mm"</span>,
  <span class="dt">keep =</span> <span class="kw">c</span>(<span class="dt">datasetID =</span> <span class="st">"source_measurement"</span>, <span class="dt">measurementRemark =</span> <span class="st">"note"</span>),
  <span class="dt">metadata =</span> <span class="kw">list</span>(
    <span class="dt">bibliographicCitation =</span> <span class="kw">attributes</span>(carabids)<span class="op">$</span>citeAs,
    <span class="dt">author =</span> <span class="st">"Fons van der Plas"</span>,
    <span class="dt">license =</span> <span class="st">"http://creativecommons.org/publicdomain/zero/1.0/"</span>
    )
)</code></pre></div>
<pre><code>## Input is taken to be a species -- trait matrix. If this is not the case, please provide parameters!</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">data</span>(heteroptera_raw)</code></pre></div>
<pre><code>## loading dataset 'heteropteraRaw' from original data source! 
##  When using this data, please cite the original publication: 
## Gossner MM, Simons NK, Höck L and Weisser WW (2015). "Morphometric
## measures of Heteroptera sampled in grasslands across three regions
## of Germany." _Ecology_, *96*, pp. 1154. doi: 10.1890/14-2159.1
## (URL: http://doi.org/10.1890/14-2159.1).</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dataset2 &lt;-<span class="st"> </span><span class="kw"><a href="../reference/as.traitdata.html">as.traitdata</a></span>(heteroptera_raw,
  <span class="dt">taxa =</span> <span class="st">"SpeciesID"</span>,
  <span class="dt">traits =</span> <span class="kw">c</span>(<span class="st">"Body_length"</span>, <span class="st">"Body_width"</span>, <span class="st">"Body_height"</span>, <span class="st">"Thorax_length"</span>,
    <span class="st">"Thorax_width"</span>, <span class="st">"Head_width"</span>, <span class="st">"Eye_width"</span>, <span class="st">"Antenna_Seg1"</span>, <span class="st">"Antenna_Seg2"</span>,
    <span class="st">"Antenna_Seg3"</span>, <span class="st">"Antenna_Seg4"</span>, <span class="st">"Antenna_Seg5"</span>, <span class="st">"Front.Tibia_length"</span>,
    <span class="st">"Mid.Tibia_length"</span>, <span class="st">"Hind.Tibia_length"</span>, <span class="st">"Front.Femur_length"</span>,
    <span class="st">"Hind.Femur_length"</span>, <span class="st">"Front.Femur_width"</span>, <span class="st">"Hind.Femur_width"</span>,
    <span class="st">"Rostrum_length"</span>, <span class="st">"Rostrum_width"</span>, <span class="st">"Wing_length"</span>, <span class="st">"Wing_widt"</span>),
  <span class="dt">units =</span> <span class="st">"mm"</span>,
  <span class="dt">keep =</span> <span class="kw">c</span>(<span class="dt">sex =</span> <span class="st">"Sex"</span>, <span class="dt">references =</span> <span class="st">"Source"</span>, <span class="dt">lifestage =</span> <span class="st">"Wing_development"</span>),
  <span class="dt">metadata =</span> <span class="kw">list</span>(
    <span class="dt">bibliographicCitation =</span> <span class="kw">attributes</span>(heteroptera_raw)<span class="op">$</span>citeAs,
    <span class="dt">license =</span> <span class="st">"http://creativecommons.org/publicdomain/zero/1.0/"</span>
    )
)</code></pre></div>
<pre><code>## it seems you are providing repeated measures of traits on multiple specimens of the same species (i.e. an occurrence table)! Sequential identifiers for the occuences will be added. If your dataset contains user-defined occurrenceIDs you may specify the column name in parameter 'occurrences'.</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">database &lt;-<span class="st"> </span><span class="kw">rbind</span>(dataset1, dataset2)</code></pre></div>
<pre><code>## Warning in rbind(deparse.level, ...): There seems to be no overlap in trait names of the provided datasets. 
##            It is recommended to map 'traitNameStd' of each dataset to the same thesaurus or ontology!</code></pre>
<pre><code>## Warning in rbind(deparse.level, ...): There seems to be no overlap in taxon names of the provided datasets. 
##             It is recommended to map 'ScientificNameStd' of each dataset to the same thesaurus or ontology!</code></pre>
<p>The detailled metadata information (e.g. license and bibliographic citation) will be stored in the attributes of the dataset and displayed when calling it in R.</p>
</div>
<div id="add-data-layers" class="section level2">
<h2 class="hasAnchor">
<a href="#add-data-layers" class="anchor"></a>add data layers</h2>
<p>When storing data, it might be advised to externalise repetitive entries in a separate datasheet and link to it via datasetID. In R, you can use the function <code>merge()</code> to map metadata information from a second data table into the core data table based on the datasetID.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co">#example for adding metadata as a table</span></code></pre></div>
</div>
<div id="compile-aggregate-values" class="section level2">
<h2 class="hasAnchor">
<a href="#compile-aggregate-values" class="anchor"></a>compile aggregate values</h2>
<p>The function <code><a href="../reference/cast.traitdata.html">cast.traitdata()</a></code> rearranges the long-table format into the more intuitive wide-table or matrix format. This can be used to preview complex datasets or to perform calculations on multivariate values.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(dataset3)</code></pre></div>
<pre><code>##         scientificName traitName traitValue traitUnit measurementID
## 1 Anyphaena accentuata Body_Size       6.25        mm             1
## 2 Aculepeira ceropegia Body_Size         11        mm             2
## 3     Agalenatea redii Body_Size       6.93        mm             3
## 4   Araneus diadematus Body_Size      11.88        mm             4
## 5    Araneus marmoreus Body_Size      10.03        mm             5
## 6    Araneus quadratus Body_Size      12.25        mm             6
## 
## This trait-dataset contains 10 traits for 1230 taxa ( 6 measurements in total).
## 
## [1]:</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">dataset3wide &lt;-<span class="st"> </span><span class="kw"><a href="../reference/cast.traitdata.html">cast.traitdata</a></span>(dataset3)</code></pre></div>
<pre><code>## Aggregation requires fun.aggregate: length used as default</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(dataset3wide)</code></pre></div>
<pre><code>##   value Body_Size Dispersal_ability Feeding_guild Feeding_mode
## 1 (all)      1230              1230          1230         1230
##   Feeding_specialization Feeding_tissue Feeding_plant_part
## 1                    755            306                450
##   Endophagous_lifestyle Stratum_use Stratum_use_short
## 1                   117        1230              1230</code></pre>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#reading-data">1. reading data</a></li>
      <li>
<a href="#transfer-into-measurement-longtable-format">2. transfer into measurement longtable format</a><ul class="nav nav-pills nav-stacked">
<li><a href="#case-example-provide-measurement-unit">case example: provide measurement unit</a></li>
      <li><a href="#case-example-raw-data-are-coded-as-numeric-factor-levels">case example: raw data are coded as numeric factor levels</a></li>
      <li><a href="#case-example-keep-additional-data-columns">case example: keep additional data columns</a></li>
      <li><a href="#case-example-adding-further-information-on-traits-species-or-single-measurements">case example: adding further information on traits, species or single measurements</a></li>
      <li><a href="#case-example-mutate-original-columns-into-derived-values">case example: mutate original columns into derived values</a></li>
      </ul>
</li>
      <li>
<a href="#standardise-taxon-names-and-trait-values">3. standardise taxon names and trait values</a><ul class="nav nav-pills nav-stacked">
<li><a href="#taxon-name-standardisation">taxon name standardisation</a></li>
      <li><a href="#trait-name-and-value-standardisation">trait name and value standardisation</a></li>
      <li><a href="#georeference-standardization-for-biodiversity-exploratories">georeference standardization for Biodiversity Exploratories</a></li>
      <li><a href="#single-stroke-standardization">single stroke standardization</a></li>
      </ul>
</li>
      <li>
<a href="#working-with-trait-datasets">4.Working with trait datasets</a><ul class="nav nav-pills nav-stacked">
<li><a href="#combine-multiple-traitdata-tables">combine multiple traitdata tables</a></li>
      <li><a href="#add-data-layers">add data layers</a></li>
      <li><a href="#compile-aggregate-values">compile aggregate values</a></li>
      </ul>
</li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Florian D. Schneider.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://hadley.github.io/pkgdown/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
